P2P 網絡構建
=====
前言
-----
* ### 常見的分散式服務中，實現不同節點間的高效通信是一項基礎技術。
* ### 區塊鏈系統為分散式服務的一種。
* ### P2P 通信網絡是區塊鏈系統中數據傳輸、共識達成一致的基礎。
4.1 P2P 簡介
-----
* ### P2P 即 Peer - to - Peer，P2P 網絡是一類允許一組用戶互相連接並直接從用戶硬盤上獲取文件的網絡。
* ### P2P 演化成一種分布式網絡，在 P2P 分布式網絡中。
	* ### 網絡的各個節點，無論是機構還是個人，可以共享他們所擁有的一部分軟、硬件資源。
	* ### 如: 數據處理能力、信息儲存能力、互聯網連接能力、打印機等。
	* ### 這些共享資源能被其它對等節點(peer)直接訪問，無須經過中間的服務器。
* ### P2P 網絡中的每個節點都是雙重身份，既是服務和內容共享資源的提供者(server)，又是服務和內容等資源的獲取者(client)。
* ### P2P 網絡特點
	* ### 無中央服務器，打破了 C/S 模式。
	* ### 用戶之間互聯並可以分享文件。
* ### P2P 技術和 P2P 網絡的好處: 資源能得到充分利用和最大化的共享。
* ### 文件共享類的 P2P 網絡服務
	* ### Napster
	* ### Gnutella
	* ### eDonkey
	* ### emule
	* ### BitTorrent
* ### 挖掘 P2P 對等計算能力和儲存共享能力的應用
	* ### SETI@home
	* ### Avaki
	* ### Popular Power
* ### 基於 P2P 方式的協同處理與服務共享平台
	* ### JXTA
	* ### Magi
	* ### Groove
* ### P2P 分布式網路核心
	* ### 數據儲存在客戶端本地。
	* ### 提供本地儲存信息的查詢服務。
	* ### 網絡中各個節間能直接進行數據傳遞。
	* ### 數據傳遞可以通過文件的名稱、文件的地址等實現。
* ### P2P 分布式網路中
	* ### 數據流量得到了分流。
	* ### 管理節點不再有服務容量的壓力，只需儲存數據相關的索引與鏈結等內容即可。
	* ### IPFS 文件系統就是基於 P2P 分布式網絡的一種實現。
4.2 區塊鏈 P2P 網絡實現技術總結
-----
* ### 在區塊鏈領域，不同的公鏈系統所使用的 P2P 網絡技術大不相同
	* ### TCFS 基於 IPFS 實現。
	* ### 比特幣系統的 P2P 網絡是無結構的。
	* ### 以太坊的 P2P 網絡是有結構的。
* ### 在以太坊中，P2P 網絡主要採用 Kademlia 算法實現，Kademlia 是分散式雜湊表(Distributed Hash Table, DHT)技術的一種，藉由此技術，以太坊系統實現了在分布式環境下快速準確地路由和定位數據。
* ### 分散式雜湊表
	* ### 由廣域網內大量節點共同維護的巨大散列表。
	* ### 散列表被分割成不連續的塊，每個節點被分配給一個屬於自己的散列塊，並成為這個散列表的管理者。
	* ### DHT 的節點是動態的，在節點中，通過加密散列函數，對象的名字或關鍵詞就可以被映射為 128 bit 或 160 bit 的散列值。
* ### 比特幣系統的網絡結構是最容易理解、最容易實現的一種形式。
* ### 以太坊網絡引入了分布式散列表、異或距離、二叉前綴樹、K - 桶等，結構更為複雜，實現也更困難，但在節點路由上速度遠快於比特幣，本質上屬於空間換取時間的做法。
* ### Java 領域網絡編程或遠程通信技術 (基礎)
	* ### Socket
	* ### RMI (Remote Method Invocaation, 遠程方法調用)
	* ### RPC (Remote Procedure Call, 遠程過程調用)
	* ### Apache Mina (基於 TCP / IP、UDP/IP 協議的通信架構)
	* ### Hessian (輕量級 remoting onhttp 工具)
	* ### JMS (Java Message Service, Java 消息服務)
	* ### Netty (JBOSS 提供的一個 Java 版網絡服務器和客戶端程序開發框架)
	* ### WebService (如: HTTP)
* ### Java 領域網絡編程或遠程通信技術 (新)
	* ### WebSocket (HTML5 中的新協議)
	* ### Vert.x (基於 JVM、輕量級、高興能的應用平台)
	* ### t - io (基於 Java Aio 的網絡編程框架，號稱可以讓天下沒有難開發的網絡編程)
	* ### J - IM (使用 Java 編寫，基於 t - io 開發的輕量級、高性能網絡框架)
	* ### http - kit
	* ### netty - socketio (基於全異步 Java 服務器)
	* ### async - http - client
* ### 聯盟鏈中各個節點可以共同訂閱相同的 topic，節點需要達成共識或同步數據，向該 topic 推送不同類型的消息即可，包括該節點在內的所有節點均可以通過訂閱 topic 來實現消息的接收並進行相應處理。
* ### 在聯盟鏈中，通過區塊鏈底層管理後台，我們可以獲取各個節點部屬服務器的公網 IP。
* ### 可基於 HTTP 或 RPC(ProtoNuffer、Thrift)構建節點通信網絡。
* ### 客戶端發消息時，遍利所有節點供網 IP 列表，分別向這些服務器發送 HTTP 請求或 RPC 請求，由於各個節點都不屬了對應的服務端程序，因此可以對收到的 HTTP 請求或 RPC 請求進行處理。
* ### P2P 網絡中各節點的通信就是字節將流從一台服務器傳送到另外一台服務器的過程，基於傳輸協議(如: HTTP、TCP、UDP 等協議)和網絡  I / O 實現。
* ### HTTP、TCP、UDP 皆基於 Socket 實現。
4.3 基於 WebSocket 構建 P2P 網絡
-----
* ### WebSocket 約定了通信的規範，通過握手機制，各戶端(如瀏覽器和服務端)之間建立一個類似 TCP 的長連接，方便客戶端和服務端之間的通信，且服務端能主動向客戶端堆送消息。
* ### WebSocket 工作流程
	* ### 瀏覽器透過 JS 代碼向服務端發出建立 WebSocket 連接的請求。
	* ### WebSocket 連接建立後，客戶端和服務端就可以通過 TCP 連接傳輸數據。
* ### 基於 WebSocket 構建 P2P 網絡 Java 實戰
	* ### 連接成功調用方法 onOpen()
	* ### 連接關閉調用方法 onClose()
	* ### 收到客戶端消息後調用方法 onMessage()
	* ### 發生錯誤調用方法 onError()
	* ### 在區塊鏈系統中，每個節點既是服務端又是客戶端; 既是消息的發出者，又是消息的接收者。
	* ### 與常見 Java Web 開發中使用 WebSocket 不同，需要在服務端之間進行消息通信，因此不能使用 spring - boot - starter - WebSocket 依賴。	
* ### Java - WebSocket 是一個輕量級、100% 用 java 實現的 WebSocket 客戶端服務端工具包。
