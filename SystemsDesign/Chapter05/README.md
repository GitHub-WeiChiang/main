Chapter05 設計具有一致性的雜湊算法
=====
* ### 透過雜湊取餘進行負載平衡的伺服器選擇方式，在伺服器數量固定且資料分佈均勻時是很好的做法，但當伺服器數量改變或資料分佈不均勻會導致大量快取失效。
* ### 一致性的雜湊 (consistent hashing) 可以減緩上述問題。
* ### 一致性的雜湊，當雜湊大小改變時平均只能有 k / n 個 key 需要重置對應關係 (k = key, n = slot)，非一致性的雜湊幾乎所有的 key 都要重置。
* ### 一致性的雜湊透過將雜湊的兩端連接，形成雜湊環 (hash ring)。
* ### 伺服器透過取 ip 雜湊對應到雜湊環上。
* ### 快取也透過取 key 雜湊對應到雜湊環上，並以順時針方向存入第一個碰到的伺服器。
* ### 當伺服器數量有異動時，只需修改少部分快取儲存位置。
* ### 基本雜湊環問題
    * ### 伺服器的添加或移除，會造成伺服器的分區 (partition) 非常不均勻。
    * ### 各個鍵在雜湊環上的分佈沒有理想上這麼均勻。
    * ### 透過虛擬節點 (virtual node) 或副本 (replicas) 的技術可以解決上述問題。
* ### 每一個虛擬節點都會指向一個伺服器，一台伺服器將負責多個虛擬節點。
* ### 虛擬節點的數量越多，分佈也就越均勻，標準差 (standard deviation) 越小，200 個虛擬節點標準差約為 5 %，100 個虛擬節點標準差約為 10 %，但虛擬節點的增加會導致需要更多空間儲存相關資訊。
* ### 如何找出受影響的快取 key ?
    * ### 從添加處開始逆時針移動，再遇到另一台伺服器前所遇到的節點將被分配給新伺服器。
    * ### 從移除處開始逆時針移動，再遇到另一台伺服器前所遇到的節點將被分配給順時針移動所遇到的第一台伺服器。
* ### 一致性的雜湊 - 總結
    * ### 最小化重新分配負擔。
    * ### 易於水平擴展。
    * ### 可以緩解熱門鍵問題。
<br />
