Chapter02 粗略的估算
=====
* ### 記憶體階層
    * ### 暫存器: 最快的存取。
    * ### 快取 (L1 ~ L3: SRAM、L4: DRAM)
        * ### 第一級快取 (L1): 通常存取只需要幾個週期，通常是幾十個 KB。
        * ### 第二級快取 (L2): 比 L1 約有 2 到 10 倍較高延遲性，通常是幾百個 KB 或更多。
        * ### 第三級快取 (L3): 比 L2 更高的延遲性，通常有數 MB 之大。
        * ### 第四級快取 (L4): CPU 外部的 DRAM，但速度較主記憶體高 (不一定有這層)。
    * ### 主記憶體 (DRAM): 存取需要幾百個週期，可以大到數十 GB。
    * ### 磁碟儲存: 需要成千上萬個週期，容量非常大。
* ### 延遲相關數字
    * ### L1 快取參照: 0.5 ns。
    * ### L2 快取參照: 7 ns。
    * ### 互斥鎖的鎖定與解鎖: 100 ns。
    * ### 主記憶體參照: 100 ns。
    * ### 用 Zippy 壓縮 1 KB 資料: 10 µs。
    * ### 在 1 Gbps 網路發送 1MB 資料: 20 µs。
    * ### 從記憶體循序讀取 1 MB 資料: 250 µs。
    * ### 磁碟搜尋: 10 ms。
    * ### 從網路讀取 1 MB 資料: 10 ms。
    * ### 從磁碟讀取 1 MB 資料: 30 ms。
    * ### 發送封包 (加州 -> 荷蘭 -> 加州): 150 ms。
* ### 段落結論
    * ### 記憶體快磁碟慢。
    * ### 避免磁碟搜尋。
    * ### 簡單壓縮算法速度快。
    * ### 資料先壓縮後傳送。
* ### 高可用性 (high availability): 理想的一段時間內系統連續運行的能力。
    * ### 99%: 每天停 14 分鐘，每年停 3.6 天。
    * ### 99.9%: 每天停 1.4 分鐘，每年停 8.7 小時。
    * ### 99.99%: 每天停 8.6 秒，每年停 52.6 分鐘。
    * ### 99.999%: 每天停 0.8 秒，每年停 5.2 分鐘。
    * ### 99.9999%: 每天停 0.08 秒，每年停 31 秒。
* ### 估算範例
    * ### 假設
        * ### 每個月 3 億活躍使用者。
        * ### 每天 50 % 使用。
        * ### 每人一天平均 2 則貼文。
        * ### 10 % 的堆文中包含多媒體。
        * ### 資料儲存五年。
    * ### 估算
        * ### 每日活躍用戶 (DAU, Daily active users) = 3 * 0.5 = 1.5 億。
        * ### 推文每秒查詢次數 (QPS, Query per second) = 1.5 億 * 2 / 24 / 3600 s = 3500。
        * ### QPS 峰值 = 2 * 3500 = 7000。
    * ### 假設
        * ### 推文平均大小: tweet_id (64 Byte)、文字 (140 Byte)、媒體 (1 MB)。
    * ### 估算
        * ### 媒體每日所需空間: 1.5 億 * 2 * 10 % * 1 MB = 30 TB。
        * ### 五年所需媒體空間: 30 TB * 365 * 5 = 55 PB。
* ### 估算邏輯
    * ### 四捨五入。
    * ### 寫下假設。
    * ### 標記單位。
    * ### 估算數值 (DAU、QPS、QPS 峰值、儲存空間)。
<br />
